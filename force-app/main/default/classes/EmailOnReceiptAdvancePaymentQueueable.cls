global class EmailOnReceiptAdvancePaymentQueueable implements Queueable, Database.AllowsCallouts{
    global List<String> receiptIds = new List<String>();
    global EmailOnReceiptAdvancePaymentQueueable(List<String> receiptIdList){
        receiptIds = new list<String>(receiptIdList);
    }
    global void execute(QueueableContext context) { 
        List<Receipt__c> receiptList = [SELECT name,id,Project_Unit__r.Name,Total_Amount__c,Receipt_No__c,New_Sale_Approval__c,
                                        Currency__c,Booking__r.Tower__c,Booking__r.Name,Booking__r.Primary_Applicant_Name__c,
                                        New_Sale_Approval__r.Owner.email,New_Sale_Approval__r.Payment_Request__r.Name__c,
                                        New_Sale_Approval__r.Payment_Request__r.Email__c,GL_Date__c,Project__c,Payment_Request__c,
                                        Booking__r.Primary_Applicant_Email__c,Booking__r.Sales_Head__c,
                                        Booking__r.Secondary_Sales_Manager_VP__c,Booking__r.Sales_Head__r.Manager.Email,
                                        Booking__r.Secondary_Sales_Head__r.Manager.Email,
                                        Booking__r.Secondary_Sales_Manager_VP__r.email,Booking__r.Sales_Head__r.email,
                                        Booking__r.Sales_Managers__r.email,Booking__r.Secondary_Sales_Manager__r.email,
                                        Booking__r.Secondary_Sales_Head__r.email,Receipt_Number__c,
                                        Advance_Payment_Rebate__r.createdBy.email,Advance_Payment_Rebate__r.createdBy.Name
                                        FROM Receipt__c 
                                        WHERE Id IN : receiptIds];
        List<Messaging.SingleEmailMessage> emailsList = new  List<Messaging.SingleEmailMessage>();
        for(Receipt__c receipt : receiptList){
            
            Messaging.SingleEmailMessage email = new Messaging.SingleEmailMessage();              
            email.setSubject('Auto credit note generated by Advance payment rebate');
            List <String> lststringtoaddress = new List<String>();
            List <String> lstStringccaddress = new List <String>();
            List <String> lstStringbccaddress = new List <String>();
            
            String body =  'Dear ' +receipt.Advance_Payment_Rebate__r.CreatedBy.Name+', <br/><br/>'+'Credit note '+ receipt.Receipt_Number__c +' has been generated.<br/><br/>'+                
                'Thanks<br/>';
            
             List<String> sendingTo = new List<String>();
            sendingTo.add(receipt.Advance_Payment_Rebate__r.CreatedBy.email);
            email.setToAddresses(sendingTo);
            email.setHtmlBody('<span style="font-family:Tahoma;font-size:14px;" >'+body+'</span>');
            
            if(receipt != null)
                emailsList.add(email);
            
        }
        Messaging.sendEmail(emailsList);
    }
}